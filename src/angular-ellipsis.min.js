angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window",function(a,b){var c=function(b){var c=null,d=[];this.remove=function(b){-1!==d.indexOf(b)&&(d.splice(d.indexOf(b),1),0===d.length&&(a.cancel(c),c=null))},this.add=function(e){-1===d.indexOf(e)&&d.push(e),c||(c=a(function(){var a=d.slice();c=null,d.length=0,a.forEach(function(a){a()})},b))}},d=new c(0),e=new c(75);return{restrict:"A",scope:{ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"="},compile:function(a,c,f){return function(a,c,f){function g(a){var b=0;return angular.forEach(a.parent().children(),function(c){c!=a[0]&&(b+=c.clientHeight)}),a.parent()[0].clientHeight-b}function h(){var b=a.ngBind||a.ngBindHtml;if(b){var d=!a.ngBind&&!!a.ngBindHtml,e=0,h="undefined"!=typeof f.ellipsisSymbol?f.ellipsisSymbol:"&hellip;",j="undefined"!=typeof a.ellipsisSeparator?f.ellipsisSeparator:" ",k="undefined"!=typeof a.ellipsisSeparatorReg?a.ellipsisSeparatorReg:!1,l="undefined"!=typeof a.ellipsisAppend&&""!==a.ellipsisAppend?h+"<span>"+a.ellipsisAppend+"</span>":h,m=k?b.match(k):b.split(j);if(f.isTruncated=!1,d?c.html(b):c.text(b),i(c,a.useParent)){var n=m.length,o=a.useParent?g(c):c[0].clientHeight;for(d?c.html(b+l):c.text(b).html(c.html()+l),c.attr("data-overflowed","true");n>e;e++)if(m.pop(),d?c.html(m.join(j)+l):c.text(m.join(j)).html(c.html()+l),(a.useParent?c.parent()[0]:c[0]).scrollHeight<o||i(c,a.useParent)===!1){f.isTruncated=!0;break}h!=l&&"undefined"!=typeof a.ellipsisAppendClick&&""!==a.ellipsisAppendClick&&c.find("span").bind("click",function(b){a.$apply(function(){a.ellipsisAppendClick.call(a,{event:b})})})}}}function i(a,b){return a=b?a.parent():a,a[0].scrollHeight>a[0].clientHeight}function j(){(f.lastWindowResizeWidth!=window.innerWidth||f.lastWindowResizeHeight!=window.innerHeight)&&h(),f.lastWindowResizeWidth=window.innerWidth,f.lastWindowResizeHeight=window.innerHeight}function k(){e.add(j)}f.lastWindowResizeTime=0,f.lastWindowResizeWidth=0,f.lastWindowResizeHeight=0,f.lastWindowTimeoutEvent=null,f.isTruncated=!1,a.$watch("ngBind",function(){d.add(h)}),a.$watch("ngBindHtml",function(){d.add(h)}),a.$watch("ellipsisAppend",function(){h()});var l=angular.element(b);l.bind("resize",k),a.$on("$destroy",function(){l.unbind("resize",k),d.remove(h),e.remove(j)})}}}}]);