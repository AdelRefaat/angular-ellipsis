angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window",function(a,b){var c=function(b){var c=null,d=[];this.remove=function(b){-1!==d.indexOf(b)&&(d.splice(d.indexOf(b),1),0===d.length&&(a.cancel(c),c=null))},this.add=function(e){-1===d.indexOf(e)&&d.push(e),c||(c=a(function(){var a=d.slice();c=null,d.length=0,a.forEach(function(a){a()})},b))}},d=new c(0),e=new c(75);return{restrict:"A",scope:{ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"="},compile:function(a,c,f){return function(a,c,f){function g(a){var b=0;return angular.forEach(a.parent().children(),function(c){c!=a[0]&&(b+=c.clientHeight)}),a.parent()[0].clientHeight-b}function h(){var b=a.ngBind||a.ngBindHtml;if(b){var d=0,e="undefined"!=typeof f.ellipsisSymbol?f.ellipsisSymbol:"&hellip;",h="undefined"!=typeof a.ellipsisSeparator?f.ellipsisSeparator:" ",j="undefined"!=typeof a.ellipsisSeparatorReg?a.ellipsisSeparatorReg:!1,k="undefined"!=typeof a.ellipsisAppend&&""!==a.ellipsisAppend?e+"<span>"+a.ellipsisAppend+"</span>":e,l=j?b.match(j):b.split(h);if(f.isTruncated=!1,c.html(b),i(c,a.useParent)){var m=l.length,n=a.useParent?g(c):c[0].clientHeight;for(c.html(b+k),c.attr("data-overflowed","true");m>d;d++)if(l.pop(),c.html(l.join(h)+k),(a.useParent?c.parent()[0]:c[0]).scrollHeight<n||i(c,a.useParent)===!1){f.isTruncated=!0;break}e!=k&&"undefined"!=typeof a.ellipsisAppendClick&&""!==a.ellipsisAppendClick&&c.find("span").bind("click",function(b){a.$apply(function(){a.ellipsisAppendClick.call(a,{event:b})})})}}}function i(a,b){return a=b?a.parent():a,a[0].scrollHeight>a[0].clientHeight}function j(){(f.lastWindowResizeWidth!=window.innerWidth||f.lastWindowResizeHeight!=window.innerHeight)&&h(),f.lastWindowResizeWidth=window.innerWidth,f.lastWindowResizeHeight=window.innerHeight}function k(){e.add(j)}f.lastWindowResizeTime=0,f.lastWindowResizeWidth=0,f.lastWindowResizeHeight=0,f.lastWindowTimeoutEvent=null,f.isTruncated=!1,a.$watch("ngBind",function(){d.add(h)}),a.$watch("ngBindHtml",function(){d.add(h)}),a.$watch("ellipsisAppend",function(){h()});var l=angular.element(b);l.bind("resize",k),a.$on("$destroy",function(){l.unbind("resize",k),d.remove(h),e.remove(j)})}}}}]);